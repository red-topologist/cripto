name: Crypto News Auto-Scraper

on:
  schedule:
    # GitHub Actions Cronì€ UTC ê¸°ì¤€ì…ë‹ˆë‹¤.
    # í•œêµ­ ì‹œê°„(KST) ì˜¤ì „ 8ì‹œ = ì „ë‚  UTC 23:00
    # í•œêµ­ ì‹œê°„(KST) ì˜¤í›„ 5ì‹œ = ë‹¹ì¼ UTC 08:00
    - cron: '0 23 * * *'
    - cron: '0 8 * * *'
  
  # ìˆ˜ë™ ì‹¤í–‰ ì˜µì…˜ (í…ŒìŠ¤íŠ¸ìš©)
  workflow_dispatch:

permissions:
  contents: write

jobs:
  scrape-and-commit:
    runs-on: ubuntu-latest

    steps:
    - name: ì €ì¥ì†Œ ì²´í¬ì•„ì›ƒ (Checkout Repository)
      uses: actions/checkout@v3

    - name: Python ì„¤ì • (Set up Python)
      uses: actions/setup-python@v4
      with:
        python-version: '3.9'

    - name: ì˜ì¡´ì„± ì„¤ì¹˜ (Install Dependencies)
      run: |
        python -m pip install --upgrade pip
        pip install -r requirements.txt

    - name: ë‰´ìŠ¤ ìŠ¤í¬ë© ì‹¤í–‰ (Run Scraper)
      run: python crypto_scraper.py

    - name: ë³€ê²½ ì‚¬í•­ ì»¤ë°‹ ë° í‘¸ì‹œ (Commit and Push)
      run: |
        git config --global user.name 'GitHub Action Bot'
        git config --global user.email 'action@github.com'
        git add ObsidianVault/News/Crypto/*.md
        
        # ë³€ê²½ ì‚¬í•­ì´ ìˆì„ ë•Œë§Œ ì»¤ë°‹
        if git diff --staged --quiet; then
          echo "No changes to commit."
        else
          git commit -m "ğŸ“° Auto-Update: Crypto News Briefing $(date +'%Y-%m-%d')"
          git push
        fi
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
